<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>CSV Test</title>
</head>
<body>
<h2>Reported Issues Counter</h2>
<div id="counter">Loading...</div>

<script>
  const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQH2VV-FfOWWKyr4XRaVAPxWL-8zn2dKmYB_2XxxKG_b9IfJVtgGU5xcFje_wh7WW_AyGpDABQpMlFo/pub?gid=27103071&single=true&output=csv';

  // Simple CSV parser
  function parseCSV(csvText) {
    const lines = csvText.trim().split('\n');
    const headers = lines[0].split(',');
    return lines.slice(1).map(line => {
      const values = line.split(',');
      const obj = {};
      headers.forEach((h,i) => obj[h] = values[i]);
      return obj;
    });
  }

  fetch(CSV_URL)
    .then(res => res.text())
    .then(csvText => {
      const data = parseCSV(csvText);
      // Remove empty rows (sometimes the first row is empty)
      const validRows = data.filter(r => r.LP_UNIQUE_REF);
      document.getElementById('counter').textContent = "Reported issues: " + validRows.length;
      console.log(validRows); // log the data for inspection
    })
    .catch(err => {
      document.getElementById('counter').textContent = "Error loading CSV";
      console.error(err);
    });
</script>
</body>
</html>
